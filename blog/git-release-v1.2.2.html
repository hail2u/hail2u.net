<!DOCTYPE html><html lang="ja"><head><title>git-release v1.2.2</title><p><time>2016-12-31</time></p><h1>git-release v1.2.2</h1>

<p><a href="https://github.com/hail2u/node-git-release">git-release</a>へテストを走らせる機能を追加した。<code>package.json</code>が見つかり、かつテストが定義されている場合に<code>npm test</code>を走らせるという自分の必要最小限のものだけにしておいた。冬になるとタイピングをミスってよく<kbd>npm test &amp; git release patch</kbd>とやってしまい、アーアーアーってなるのを予防したかった。</p>

<p>Gitと同じようにnpmでもいくつかnpm関連の情報を出力するだけのサブコマンドがある。<code>prefix</code>サブコマンドは一番近い<code>package.json</code>のあるディレクトリーかカレント・ディレクトリーが出力される。</p>

<pre>$ npm prefix
C:/Users/Kyo/Projects/node-git-release</pre>

<p>あとはそこにあるかもしれない<code>package.json</code>を読んで、<code>scripts</code>フィールドの<code>test</code>が存在すれば<code>npm test</code>を実行するだけだ。<code>package.json</code>読んで色々取得できるサブコマンドとかも欲しくなる。</p>

<p>テストが通れば、今までと同じようにバージョン番号を上げて、コミットし、タグをつけ、設定によってはプッシュする。</p>

<p>テストが通らない時にリリースできないというささやかな問題はあるが、僕の用途ではこれで十分そうだった。<code>private</code>フィールドを見て、それに応じて<code>npm publish</code>するまで自動化したいが、<code>publishConfig</code>フィールドのことがよくわかっていないのでまだやっていない。設定を増やすと解決できるが、それはしたくない。まずは<code>private</code>と<code>publishConfig</code>がない場合だけ<code>npm publish</code>も走らせるようにすれば良いのかもしれない。</p>

<hr>

<p>簡単にやりたい場合はBashで<code>npm</code>や<code>git</code>をフックして<code>npm test</code>を差し込むだけでも良い。しかしそれだと実行する時にnpm関連のプロジェクトかどうかで使い分ける必要があり、感覚的に面倒だった。それをラップして良しなに振り分けるにはBash力が0に近すぎて無理だった。</p>

<p>Bash力を上げたい……とはまったく思わなくて不思議だ。BashスクリプトはVimスクリプトと同じくらい書きたくない。</p>
