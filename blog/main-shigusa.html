<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>main()しぐさ</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2018-01-04</time></p>

    <h1>main()しぐさ</h1>

    <p><code>async</code>と<code>await</code>で書いていると、とりあえず<code>async</code>してあげるためだけの<code>main()</code>を書きたくなる(書いている)。これを見たり書いたりすると古の作法を思い出してしまい、体がかゆくなってしまう。セケンではあまり話題になっていなさそうなので、僕がうまく使えていないだけのようだ。それともざっくりIIFEで括るのが主流なのだろうか。<code>&quot;use async&quot;;</code>とかないのかな。</p>

<pre><code class="language-javascript">await thud(
  await xyzzy(
    await plugh(
      await fred(
        await waldo(
          await garply(
            await grault(
              await corge(
                await quux(
                  await qux(
                    await baz(
                      await bar(
                        await foo()))))))))))));</code></pre>

<p>いわゆるwaterfallと呼ばれるようなバケツリレーの処理をこのようなコードに機械的に変換していたら楽しくなってきた。ネストがどうとかいうことより、実際に処理される順と書かれている順が真逆なので良くない。カッコの中に<code>await</code>を書くのが良くないという話か、<code>await</code>は必ず明示的に値を受け取るべきという話なのかもしれない。</p>

<p>Promiseと違って<code>async</code>/<code>await</code>は書きやすさのわりに人が書くべきものではないという印象を持ってしまった。フローチャートを書いたら変換してくれるような自動コード生成の分野で最大の威力を発揮しそうだ。でも書く。</p>
  </body>
</html>
