<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="same-origin" name="view-transition">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>Edge 17でのネストしたカスタム・プロパティーとショートハンド・プロパティーにおけるバグ</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2018-05-10</time></p>

    <h1>Edge 17でのネストしたカスタム・プロパティーとショートハンド・プロパティーにおけるバグ</h1>

    <p>タイトルまま。Edge 17では<code>margin</code>プロパティーなどのショートハンド・プロパティーでカスタム・プロパティーをネストして(<code>calc()</code>などと共に)利用すると、値が解決できず<code>0</code>になってしまう。Edge 16では問題なく解決できるので、リグレッション・バグということになる。</p>

<p>View Demo: <a href="https://jsfiddle.net/k2hswvvp/">Shorthand Property and Nested Custom Property</a></p>

<p>デモでは二番目の要素でネストしたカスタム・プロパティーを利用している。一番目の要素では普通の(？)カスタム・プロパティーで、うまく解決できている。二番目では解決できておらず、本来は<code>1rem</code>確保されるはずのマージンが<code>0</code>になっている。他の現行ブラウザーやEdge 16では問題ない。</p>

<p>2018-05-10現在、このウェブサイトでもそこかしこでバグっている。グローバル・ナビゲーションや<code>hr</code>要素で目立つ。</p>

<p>CSS側でショートハンド・プロパティーを使わない、という対処で簡単に直せる。しかし最小化ツールがショートハンドにまとめてくれたりしてしまい、直したつもりがプロダクションでは直っていないということもある(やった)。ここに注意すればブラウザーのアップデートを待たずに修正できるだろう。</p>

<hr>

<p>条件がなかなかシビアで、ショートハンド・プロパティーで使った場合のみ起こることに気付くまで時間がかかった。既にEdgeのイシュー・トラッカーに<a href="https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/16802744/">同様の報告</a>があるが、1か月経つのに確認されておらず、不穏だ。すぐには直りそうもないので、前述のようにCSS側で対処する方が良いだろう。</p>
  </body>
</html>
