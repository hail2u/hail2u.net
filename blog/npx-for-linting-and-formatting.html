<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="width=device-width" name="viewport">

    <title>リントやフォーマットをnpxで</title>

    <link title="ウェブサイト全体のRSS" href="/feed" rel="alternate" type="application/rss+xml">
    <link title="記事だけのRSS" href="/blog/feed" rel="alternate" type="application/rss+xml">
    
    
    
    <link href="/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="mailto:hail2u@gmail.com" rel="author">
    <link href="https://hail2u.net/blog/npx-for-linting-and-formatting.html" rel="canonical">
    <meta content="プロジェクトで使うリンターとフォーマッターをインストールせずに(させずに)npxで呼ぶパターンはどうなのかという実験をしている。遅いと言えばそれはもう間違いなく遅いが、いずれにしてもインストールより実行の時間が支配的なので、実用的な速度であるとは言えそうだ。たまに呼ぶ、またはGitのフックで呼ぶような場合には問題なく使えるだろう。" name="description">
    <link href="/favicon.svg" rel="icon" type="image/svg+xml">
    <link href="https://creativecommons.org/licenses/by/4.0/" rel="license">
    <link href="https://duckduckgo.com/?q=site%3Ahail2u.net" rel="search">

    <link href="/css/print.css?v=9.33.0" media="only print" rel="stylesheet">
    <link href="/css/index.css?v=9.33.0" media="only screen" rel="stylesheet">
  </head>

  <body>

      <nav id="top">
        <p class="logo"><a href="/"><span aria-label="ホームへ戻る">←</span></a></p>
      </nav>

      <header class="page-header">
          <p class="date"><time datetime="2018-02-15T14:19:33+09:00">2018年2月15日</time></p>

        <h1><em>リントやフォーマットをnpxで</em></h1>
      </header>

    <main>
      <p>プロジェクトで使うリンターとフォーマッターをインストールせずに(させずに)<a href="https://github.com/zkat/npx">npx</a>で呼ぶパターンはどうなのかという実験をしている。遅いと言えばそれはもう間違いなく遅いが、いずれにしてもインストールより実行の時間が支配的なので、実用的な速度であるとは言えそうだ。たまに呼ぶ、またはGitのフックで呼ぶような場合には問題なく使えるだろう。</p>

<p>最初の<code>npm install</code>が格段に速く終わる点をどう捉えるか、で評価が変わるだろう。最初に我慢すればその後は普通になるのが良いか、ずっと不快ではない状態が続くのが良いか。トレンドとしては前者のような気がするので、あまり受け入れられないかもしれない。<code>npm install</code>がよく失敗することなども考慮に入れると、「不快ではない」というのは開発のストレスを減らす良いアプローチだと考えられる。僕はnpx経由の方が<em>悪くない</em>という結論になりつつある。</p>

<p>npxを使うと、グローバルにインストールされているものが使われてしまう、という偶発的な問題を回避できる点も優れている。壊れているように見えないが実は壊れている環境(例えば依存が違うブランチを切り替えた後の<code>npm install</code>をし忘れた環境)でも確実に動いてくれそうな点も良さそうだ。</p>

<p>問題はバージョン違いによる設定の不整合をどうするか、という点だけに感じた。依存管理をnpxでのバージョン指定に頼るしかなさそうなため、手作業での管理になる。そのためケアレスミスもそうだが、設定またはコマンドが古いまま更新されない問題も起こりやすく、ひいてはバージョンを上げる時の負担が積み重なっていってしまう。このあたりをちゃんとやる方法を考えないといけない。</p>

<hr>

<p>Vimとかから呼ぶ場合はあまり実用的ではなかった。これが実用的ならばグローバルにインストールする必要がなくなって幸せになれそうだったが、さすがに保存時にザクザク実行される場合には無理があった。</p>

<p>非同期で呼べばなんとか……というところだが、特にフォーマッターでは感覚がつかみにくい。変更がある時はわかるが、変更がなかった時がわからないので、どれくらいで触ってよいのかよくわからなくなってしまう。ブロックしてしまった方が脳に優しい。</p>

<hr>

<p>Windows上でnpxを実行すると<code>Path must be a string</code>などと出るのは<code>npm</code>由来のバグのようだ。出力がおかしくなるだけで、特に実用上の問題はない。また既に<a href="https://github.com/npm/npm/pull/19608">それを修正するだけのPR</a>が作られており、直りそうなので気にすることはない。</p>
    </main>

    <footer class="page-footer">
      <hr>

        <p>このウェブサイトは<a href="mailto:hail2u@gmail.com">ながしまきょう</a>が<a title="Creative Commons (表示)" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>の下で作成、公開、そして更新しています。更新情報は<a href="/feed" type="application/rss+xml">RSS</a> (<a href="/blog/feed" type="application/rss+xml">記事だけのRSS</a>)または<a href="https://x.com/hail2u_">X</a>で購読できます。その他、わからないことは<a href="https://hail2u.net/about/">もう少し詳しい情報</a>を参照してください。</p>

      <p><a href="#top"><span aria-hidden="true">↑ </span>一番上</a></p>
    </footer>
  </body>
</html>
