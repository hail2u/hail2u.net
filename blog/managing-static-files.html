<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>静的ファイルの管理(v9.32.0)</title>

    <link title="ウェブサイト全体のRSS" href="/feed" rel="alternate" type="application/rss+xml">
    <link title="記事だけのRSS" href="/blog/feed" rel="alternate" type="application/rss+xml">
    
    
    
    <link href="/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="mailto:hail2u@gmail.com" rel="author">
    <link href="https://hail2u.net/blog/managing-static-files.html" rel="canonical">
    <meta content="マイナー番号が上がり、いろいろ変わったが、雰囲気は変わっていない。内部的な話で、少し前にやらかしたことから、画像を含めた静的ファイルもmainブランチに持っておくように戻す。いざとなったら再構築するだけで最新の状態を完全再現できる予定だ。それ以外にウェブサイト設定の持ち方を変えたりしてしまったのでマイナー番号を上げる。" name="description">
    <link href="/favicon.svg" rel="icon" type="image/svg+xml">
    <link href="https://creativecommons.org/licenses/by/4.0/" rel="license">
    <link href="https://m.media-amazon.com/" rel="preconnect">
    <link href="https://duckduckgo.com/?q=site%3Ahail2u.net" rel="search">

    <link href="/css/print.css?v=9.33.9" media="only print" rel="stylesheet">
    <link href="/css/index.css?v=9.33.9" media="only screen" rel="stylesheet">
  </head>

  <body>

      <nav id="top">
        <p class="logo"><a href="/"><span role="img" aria-label="ホームへ戻る">←</span></a></p>
      </nav>

      <header class="page-header">
          <p class="date"><time datetime="2024-06-29T18:17:54+09:00">2024年6月29日</time></p>

        <h1><em>静的ファイルの管理(v9.32.0)</em></h1>
      </header>

    <main>
      <p>マイナー番号が上がり、いろいろ変わったが、雰囲気は変わっていない。内部的な話で、少し前にやらかしたことから、画像を含めた静的ファイルも<code>main</code>ブランチに持っておくように戻す。いざとなったら再構築するだけで最新の状態を完全再現できる予定だ。それ以外にウェブサイト設定の持ち方を変えたりしてしまったのでマイナー番号を上げる。</p>

<p>また、ロゴとサイト・メニューで画面を縦いっぱいに使うようにする。今はサイト・メニューを真ん中寄せにしているが、スマートフォンでの操作性を考えると下寄せの方が良いかもしれない。<a href="https://neatnik.net/">メニューが別ページのウェブサイト</a>があって、ちょっといいなと思ったので、それに近いものへ移行する途中だ(けれど、断念しそうだ)。下位ページにはホームに戻るハンバーガー・ボタンを置き、あたかもフルスクリーン・メニューっぽく開けるようにしたい。</p>

<nav>
<h2>目次</h2>

<ul>
<li><a href="#oneline-grid">グリッドを1行目だけに</a></li>
<li><a href="#bottom-most-white-spaces">一番下の余白</a></li>
<li><a href="#pick-random-elements-from-array">配列からランダムに選択</a></li>
</ul>
</nav>

<section id="oneline-grid">
<h2>グリッドを1行目だけに</h2>

<p>ところどころで利用しているShowcaseコンポーネントは幅に応じて2～4列の繰り返しグリッドになっている。つまり項目が12の倍数ではない場合は、幅によって不定な数の余りが出るということだ。通常はきっちり並ばなくても良いような使い方をしているが、ホームでは12にすると多すぎる(2列6行はかなり長い)ので4に項目を絞っている関係上、3列になる幅だと1つだけ2行目に送られてしまい、納まりがあまり良くない。<code>:nth-row()</code>セレクターなどがあれば話は速いが、ないものはないのでどうにかする。</p>

<pre><code class="language-css">.showcase {
  align-items: <mark>safe</mark> end;
  display: grid;
  grid-template-columns: repeat(...);
}

.showcase.oneline {
  grid-template-rows: 1fr 0 0 0;
  overflow: hidden;
  row-gap: 0;
}</code></pre>

<p>1行目だけ高さを確保し、はみ出したものを隠し、項目間の縦の隙間を0する。<code>1fr</code>に続く<code>0</code>の数は最大で何行になるかによって変えるが多めに指定しておくと安全かもしれない。これだけで済みそうだったが、<code>align-items</code>プロパティーで<code>start</code>やそれに相当する値でない場合は、ブラウザーがなんとか表示しようと頑張ってしまうため、隠したつもりの項目が上に重なってしまう。そこで納まらない場合は<code>start</code>として配置するよう、明示的に<code>safe</code>を追加しておく。<code>safe</code>キーワードはうっかり隠れてしまわないようにするものなので、使い方はとしては間違っているような気がしないでもない。</p>

<p>ショッピング・サイトのホームで各カテゴリから商品を少しだけ並べたり、商品ページで関連商品をちょっとだけ並べたり、複数行並べると多すぎそうな場合に使うよう考えた。商品検索結果などで使うグリッドの見た目を流用しつつ、1行だけに絞ることで、統一感と一覧性を確保できると思う。しかし、コードから見るといずれ破綻しそうなことがよく見え、グリッドでやるべきことではないようにも考えられる。</p>
</section>

<section id="bottom-most-white-spaces">
<h2>一番下の余白</h2>

<p>シンプルなウェブページの場合、コンテンツが画面の下端付近まで続き、フッターが1行か2行あるだけということが多い。画面の下端付近にあるコンテンツは、横長、多分3:2 (Surface Pro)や4:3 (iPad)くらいまでの画面なら視界の範囲内なので、読みづらくなることはない。対して、縦長(2:3や3:4)の画面だと、首を動かすか、タブレット端末なら画面を持ち上げる必要が出てくると思う。Feedlyなどがそうで、Surface Proを縦にして見ているとかなり読みづらいと感じている。</p>

<p>このウェブサイトもそんな感じで読みづらいのではないかと仮説を立てたので、下の余白を大幅に増やしてみている。具体的にはポートレイトなiPadの真ん中に、16:9のやや狭い視界があると仮定し、それより下にコンテンツが来ないよう余白を計算している。</p>

<pre>(1 - 3 / 16 * 9 / 4) / 2 * 100vh = 28.906vh</pre>

<p>これからフッターの高さを引くと、コンテンツの終わりが視界に納まるようになるかもしれない。だがフッターの高さが不定なので、どうしようかと悩んでいる。とりあえずは1行分の高さを引いて誤魔化している。ただ、フッターを見たいこともあるので、引かなくても良いとも考えられる。加えておおむね画面の中央よりやや上に視界の中心があることも多そうなので、調整をせずともコンテンツの終わりが視界に入りそうな気もする。</p>
</section>

<section id="pick-random-elements-from-array">
<h2>配列からランダムに要素を切り出し</h2>

<p>配列からランダムに要素を3つ切り出したい時に、シャッフルしてから先頭から3つ取り出していた。もうちょっとテキトウにできそうかなと、<code>Array().fill().map()</code>でやるように変える。パッと見に何をやっているのかわからない。</p>

<pre><code class="language-css">const pick3Articles = (articles) => Array(3)
  .fill(articles.length)
  .map((max) =&gt; articles[Math.floor(Math.random() * max)]);</code></pre>

<p><code>Array()</code>で作られる疎配列に<code>map()</code>はうまくいかないので、<code>fill()</code>を噛ませている。スプレッド構文(<code>[...Array(3)]</code>)でも良いが、使う機会があまりない<code>fill()</code>を使いたくなった。問題は切り出す要素が被ることだが、それほど致命的でもなく確率的にも低いので良しとした。</p>
</section>

<hr>

<p>他だと数千行の空行が出力されてしまうMustacheテンプレートの問題を修正したり、頻繁にValidatorをかけるようにしたりなどだ。<a href="/subscriptions/#websites">購読中のウェブサイト</a>もウェブサイトと著者を併記するように戻す。また、<a href="/blog/">雑多な記録ページ</a>で概要を表示するようにした結果、狭い画面だと長い単語のせいでレイアウトが崩れてしまう問題があった。同様の問題は<a href="/statuses/">最近の様子ページ</a>にもあるが、こちらはCSSの<code>overflow-wrap</code>プロパティーで<code>anywhere</code>を指定することで誤魔化し、雑記側は単語を修正することで直している。</p>
    </main>

    <footer class="page-footer">
      <hr>

        <p>このウェブサイトは<a href="mailto:hail2u@gmail.com">ながしまきょう</a>が<a title="Creative Commons (表示)" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>の下で作成、公開、そして更新しています。更新情報は<a href="/feed" type="application/rss+xml">RSS</a> (<a href="/blog/feed" type="application/rss+xml">記事だけのRSS</a>)または<a href="https://x.com/hail2u_">X</a>で購読できます。その他、わからないことは<a href="https://hail2u.net/about/">もう少し詳しい情報</a>を参照してください。</p>

      <p><a href="#top"><span aria-hidden="true">↑ </span>一番上</a></p>
    </footer>
  </body>
</html>
