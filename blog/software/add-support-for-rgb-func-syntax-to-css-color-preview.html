<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>CSS color previewをrgb()に対応させた</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2009-11-10</time></p>

    <h1>CSS color previewをrgb()に対応させた</h1>

    <p><a href="http://www.vim.org/">Vim</a>でCSSを編集中に色をインライン・プレビューしてくれる<a href="http://vim.sourceforge.net/scripts/script.php?script_id=2150">CSS color preview</a>というスクリプトを<code>rgb()</code>に対応させてみた。一応<code>rgba()</code>にも対応しているような感じで、透明度を無視してプレビューされる。<code>hsl()</code>とかも対応しようと思ったのだけどRGBからHSLへの変換が面倒になってすぐに諦めた。<code>hsl()</code>とか使わねーよ。</p>

<p>Download: <a href="/css.vim">rgb()/rgba()に対応したCSS color preview</a></p>

<p>インストールは$HOME/.vim/after/ftplugin(Windowsでは$HOME/vimfiles/after/ftplugin)にcss.vimとしてコピーするだけ。インストールしてCSSファイルを開くと、</p>

<figure>
<img alt="rgb()/rgba()に対応したCSS color previewのプレビュー画像。" height="266" src="/img/blog/css-color-preview-mod.png" width="400">
</figure>

<p>というように背景色でインライン・プレビューされる。プレビューの通り<code>rgba()</code>の透明度は反映されない。<code>matchlist()</code>で書こうとしたのだけどよくわからなかったので<code>eval()</code>で書いた……。</p>

<p>元のスクリプトで<code>set ut=100</code>とかなっていたところがちょっと気になったので削除して、<code>autocmd InsertLeave</code>で更新するようにした。改行の時とか;を入力した時にも更新できるともっと良いような気もするけど書き方わからない……。ついでに<code>autocmd</code>もグルーピングして*.cssに対してのみ行うようにした。<code>rgb()</code>対応以外の変更点はこれだけ。カーソル行の強調表示が有効な時に場合によっては文字が見づらくなる不具合も直したかったのだけど、うまい方法を思いつかなかった。</p>

<hr>

<p>最近、</p>

<pre>set guifont=DejaVu_Sans_Mono:h12:w6</pre>

<p>でgVimを使っているのだけどなかなか良い。上のプレビュー画像もこれ。デフォルトでは幅広すぎてちょっとかっこ悪い感じだけど<code>w6</code>にするとスマート。</p>
  </body>
</html>
