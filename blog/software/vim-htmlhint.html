<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">

    <title>VimからHTMLHintを使う</title>

    <link title="ウェブサイト全体のRSS" href="/feed" rel="alternate" type="application/rss+xml">
    
    <link title="雑多な記録だけのRSS" href="/blog/feed" rel="alternate" type="application/rss+xml">
    
    
    <link href="/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="mailto:hail2u@gmail.com" rel="author me">
    <link href="https://hail2u.net/blog/software/vim-htmlhint.html" rel="canonical">
    <meta content="light dark" name="color-scheme">
    <meta content="HTMLの簡単な文法チェックには長らくValidator.nuのAPIを利用していたけど、Node.jsパッケージのHTMLHintがそこそこ使えそうだったので今はこっちを使っている。ローカルで動くと気軽に使える度が増す。ただデフォルトでインストールされるCLIプログラムはリッチな感じの出力にしか対応していないので、ちょっと扱いづらい。Vimのデフォルトのerrorformatに応じた形でチェック結果を出力するだけのNode.jsスクリプトを書いて使ってる。" name="description">
    <link href="/" rel="home">
    <link href="/favicon.svg" rel="icon" type="image/svg+xml">
    <link href="/blog/" rel="index">
    <link href="https://creativecommons.org/licenses/by/4.0/" rel="license">
    <link href="https://github.com/hail2u" rel="me">
    <link href="https://x.com/hail2u_" rel="me">
    <link href="https://duckduckgo.com/?q=site%3Ahail2u.net" rel="search">
    <meta content="width=device-width" name="viewport">

    <link href="/css/print.css?v=9.32.2" media="only print" rel="stylesheet">
    <link href="/css/index.css?v=9.32.2" media="only screen" rel="stylesheet">
  </head>

  <body>

      <nav id="top">
        <p class="logo"><a href="/"><svg viewBox="0 0 16 16" role="img" aria-labelledby="logo-title"><title id="logo-title">ホームへ戻る</title><path d="m 2,7 3,7 h 7 L 14,9 13,4 9,2 Z"/></svg></a></p>
      </nav>

      <header class="page-header">
          <p class="date"><time datetime="2014-07-27T10:47:52+09:00">2014年7月27日</time></p>

        <h1><em>VimからHTMLHintを使う</em></h1>
      </header>

    <main>

    <p>HTMLの簡単な文法チェックには長らく<a href="http://validator.nu/">Validator.nu</a>のAPIを利用していたけど、Node.jsパッケージの<a href="http://htmlhint.com/">HTMLHint</a>がそこそこ使えそうだったので今はこっちを使っている。ローカルで動くと気軽に使える度が増す。ただデフォルトでインストールされるCLIプログラムはリッチな感じの出力にしか対応していないので、ちょっと扱いづらい。Vimのデフォルトの<code>errorformat</code>に応じた形でチェック結果を出力するだけのNode.jsスクリプトを書いて使ってる。</p>

<p>Download: <a href="/htmlhint">htmlhint</a> and <a href="/htmlhint.vim">htmlhint.vim</a></p>

<p>あらかじめグローバルにHTMLHintをインストールしておく必要がある。<code>htmlhint</code>をパスの通った場所に、<code>htmlhint.vim</code>を<code>~/.vim/compiler</code>ディレクトリにコピーし、<code>~/.vim/vimrc</code>などで以下の様に設定してやるとインストール完了。</p>

<pre><code class="language-vim">autocmd HTMLHint
  autocmd!

  autocmd FileType html compiler htmlhint
  autocmd FileType html autocmd! BufWritePost &lt;buffer&gt; silent make
autocmd END</code></pre>

<p>これで保存するたびにHTMLHintが走ってくれる。もちろん手動で<code>make</code>しても良い。</p>

<hr>

<p>HTMLHintはそれ(Node.js)なりに高速な動作とJSHintライクなゆるいチェックのお陰で、利用によるストレスは少ない。要素名や属性名が小文字になっているかどうかや二重引用符だけを使っているかどうかなどというValidator.nuでは警告されないものや、<code>id</code>がユニークであるかのチェックといった一歩踏み込んだものまで、なかなか良いチェック・ルールが揃っている。今はもうないけどHTML Lintという名前でウェブサービスとして公開されていた奴に似てる。</p>

<p>上記Node.jsスクリプトでは、チェックするルールは僕の好みで以下のように設定してある。</p>

<pre><code class="language-javascript">var ruleset = {
  &apos;tagname-lowercase&apos;: true,
  &apos;attr-lowercase&apos;: true,
  &apos;attr-value-double-quotes&apos;: true,
  &apos;attr-no-duplication&apos;: true,
  &apos;doctype-first&apos;: true,
  &apos;tag-pair&apos;: true,
  &apos;tag-self-close&apos;: false,
  &apos;spec-char-escape&apos;: true,
  &apos;id-unique&apos;: true,
  &apos;src-not-empty&apos;: true,
  &apos;head-script-disabled&apos;: false,
  &apos;img-alt-require&apos;: false,
  &apos;doctype-html5&apos;: true,
  &apos;id-class-value&apos;: false,
  &apos;style-disabled&apos;: true,
  &apos;space-tab-mixed-disabled&apos;: false,
  &apos;id-class-ad-disabled&apos;: false,
  &apos;href-abs-or-rel&apos;: false,
  &apos;attr-unsafe-chars&apos;: false,
  &apos;csslint&apos;: false,
  &apos;jshint&apos;: false
};</code></pre>

<p>書き方の都合上、空要素のスラッシュの省略(書かない)や<code>img</code>要素の<code>alt</code>属性の省略(書かなくて良い時もある)を許可したりしてる。半角空白とタブの混在を許可してるのは<code>pre</code>要素で稀に混ざることがあることへの対策で、<code>href</code>属性はData URIを使うこともあるのでチェックしないようにした。他は必要なさそうというものだけを無効にしてる。</p>

<p><a href="https://github.com/yaniswang/grunt-htmlhint">Gruntプラグイン</a>もあるので、CSS LintやJSHintと同じように開発フローに組み込むのも手軽で良い。とにかくカジュアルに使えてかつ最低限のHTMLクオリティを保証できそうなツールなので、積極的に使うとみんな幸せになれそう。</p>

    </main>

    <footer class="page-footer">
        <nav>
          <p><a href="/blog/"><span aria-hidden="true">⬑ </span>雑多な記録の一覧</a></p>
        </nav>

      <p><a href="mailto:hail2u@gmail.com">ながしまきょう / hail2u</a> (<a href="https://x.com/hail2u_">X</a> · <a href="https://github.com/hail2u">GitHub</a>) · <a title="Creative Commons (表示)" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a></p>

      <p><a href="/feed" type="application/rss+xml">RSS</a> (<a href="/blog/feed" type="application/rss+xml">雑多な記録だけのRSS</a>)</p>

      <p><a href="#top"><span aria-hidden="true">↑ </span>一番上</a></p>
    </footer>
  </body>
</html>
