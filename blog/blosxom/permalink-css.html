<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="same-origin" name="view-transition">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>パーマリンクに特別なCSSを追加</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2014-04-01</time></p>

    <h1>パーマリンクに特別なCSSを追加</h1>

    <p><a href="http://blosxom.sourceforge.net/">Blosxom</a>で記事ごとに専用のCSSを当てる方法を考えていた。<code>last()</code>で<code>rel=&quot;stylesheet&quot;</code>を削除してCSSの参照を追加するだけのプラグインを作るのも良いけど、やることのわりにコストが高い。単純にmetaプラグインとinterpolate_fancyプラグインを組み合わせて実現するのが手っ取り早そう。</p>

<p>記事ファイルでは特別なCSSを使うかどうかのフラグのみ書く。</p>

<pre><code class="language-markdown">パーマリンクに特別なCSSを追加
meta-special_css: 1

&lt;p&gt;...&lt;/p&gt;</code></pre>

<p>フレーバーでは以下のようにして、<code>$meta::special_css</code>を使った分岐を利用する。CSSファイルのパスは記事ファイル名を利用することでユニークさを保証できる。</p>

<pre><code class="language-html">&lt;?$meta::special_css eq=&quot;1&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;/styles$path/$fn.css&quot;&gt;
&lt;/?&gt;
&lt;?$meta::special_css ne=&quot;1&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;/styles/style.css&quot;&gt;
&lt;/?&gt;</code></pre>

<p>まだ採用はしてない。</p>

<hr>

<p>常に記事ファイル名を利用したCSSファイルのパスを参照するようにしておいて、mod_rewriteでそのパスが見つからなかった場合にデフォルトのCSSにフォールバックさせる方がもっと手っ取り早い感じする。普通にURL書き換えしちゃうとキャッシュが効かなくなるけど、302での外部リダイレクトにすれば良さそう。</p>

<pre><code class="language-apache">&lt;IfModule mod_rewrite.c&gt;
  RewriteEngine On

  RewriteBase /styles/

  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ style.css [L,R=302]
&lt;/IfModule&gt;</code></pre>

<p>こういう実装だとBlosxomに依存しないので、CSSファイルのパスをユニークにする仕組みさえ用意できれば、様々なCMSで実現できる。</p>
  </body>
</html>
