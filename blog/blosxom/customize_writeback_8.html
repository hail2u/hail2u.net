<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>Customize writeback plugin #8</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2004-05-30</time></p>

    <h1>Customize writeback plugin #8</h1>

    <p>ここのところ微妙にコメント・スパムが増えてきたので、とりあえずスパム対策のコードを追加してみた。URLに入れられている文字列が、ブラックリストなドメインを含んでいる場合、投稿させないというアプローチにしました。要はパクり！</p>
<p>あんまり使い方を説明する気は無いので、ソースを<del>見て勘で</del><ins>欲しい人は<a href="http://hail2u.wufoo.com/forms/feedback/">フィードバック・フォーム</a>で</ins>！　44行目がブロックするドメインを羅列するデータファイルのパスの設定で、実際の処理は155～163行目です。</p>
<p>また、ブロックするドメインを羅列するデータファイルの構造は、</p>
<pre>hail2u.net
example.com
example.net</pre>
<p>という感じで、1行に1つのドメインが書かれている形です。単純な正規表現で含まれているかどうかチェックしているだけなので、別にドメインでなくURLでもOK。</p>
<p>ついでにComment投稿の時は文字コードの変換を行わないようにして&quot;～&quot;が&quot;〓&quot;になるJcodeの有名な不具合に対処しておく。TrackBackはどうしようもないかな(やろうと思えばできるのですが)。こちらは173行目です。既にうちのwritebackを使っているサイトで&quot;～&quot;が&quot;〓&quot;なってうざったいという人は、こちらは適用する価値はあるかも。</p>
<p>エライ適当な実装で笑えない。</p>
<p>ほら、スパムが来るのはカリスマ<a href="http://www.blosxom.com/" title="blosxom :: the zen of blogging ::">blosxom</a>ユーザーだから。とか書こうとしたら恥ずかしくて涙が出てきました。</p>
  </body>
</html>
