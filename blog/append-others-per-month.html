<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>月ごとに分割読み込み</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2020-01-28</time></p>

    <h1>月ごとに分割読み込み</h1>

    <p>写真と書棚ページで使っていた、ユーザー操作による過去ログの一気表示を、月ごとに表示していくように変更した。ボタンを押すと前の月が、ボタンを押すとその前の月が、ボタンを押すとさらに前の月が、ボタンを押すともっと前の月が、ボタンを押すともっとその前の月が、と少しずつ進む。最後の月にはボタンはないので、そこまでになる。</p>

<p>スタイル・ガイドでも確認できるが、写真ページでもすでに確認できる。数学的なページングより、知覚的なページングの方が優れている(このウェブサイトでは関係ないが、キャッシュとしても安定度が高い)とも考えているので、そういう点でも改善できたと思う。</p>

<p>これまでは最新の24枚と残りすべてというざっくりとした分割だった。その残りすべてを月ごとに分割し、一度に表示される画像を多くても50枚くらいに抑える。少しだけ辿ってみたい、という場合を想定して、それに最適化した。</p>

<p>引き換えに写真や書影を一気に見れなくなった。画像のためページ内検索をするわけでもなく、それほど必要ないはずなので、今のところはこのまま。<code>template</code>要素に対応していない環境向けに一気に表示するページはあるので、必要そうだったらそれへのリンクを追加しようと思う。</p>

<hr>

<p>実装としてはあまり変化はない。すべての過去ログが仕込まていた<code>template</code>要素を月ごとに作るように変え、その中にサムネイルとボタンを仕込んでおく。ユーザーによりボタンが押されたら、<em>最初の<code>template</code>要素のみ</em>を引っ張り出し、その<code>template</code>要素を削除する。つまり最後まで行くと、すべての<code>template</code>要素がなくなる。</p>

<p>こうすることで<code>template</code>要素に固有の識別子を振ったり、ボタンに読み込むべき識別子を<code>data-*</code>属性で指定したり、などする手間を省いた。コードの簡略化とmustacheへの最適化の間をとって、こういう実装になった。</p>
  </body>
</html>
