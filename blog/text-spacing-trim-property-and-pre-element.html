<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>text-spacing-trimプロパティーとpre要素</title>

    <link title="ウェブサイト全体のRSS" href="/feed" rel="alternate" type="application/rss+xml">
    <link title="記事だけのRSS" href="/blog/feed" rel="alternate" type="application/rss+xml">
    
    
    
    <link href="mailto:hail2u@gmail.com" rel="author">
    <link href="https://hail2u.net/blog/text-spacing-trim-property-and-pre-element.html" rel="canonical">
    <meta content="日本語などの約物に含まれる空白(例えば、開き鍵括弧の左にある空白)などを文脈に応じて詰めるtext-spacing-trimプロパティーがChrome 123やEdge 123で一部実装されている。特に指定せずにいたり、:root要素などでtrim-firstなどを指定すると、初期値の関係や継承によりpre要素でも詰められる。そうすると(対応するOpenType機能であるhaltを所持している)等幅フォント(例えばNoto Sans Mono CJK JP)で描画される場合に文字位置がずれてしまう。" name="description">
    <link href="/favicon.svg" rel="icon" type="image/svg+xml">
    <link href="https://creativecommons.org/licenses/by/4.0/" rel="license">
    <link href="https://m.media-amazon.com/" rel="preconnect">
    <link href="https://duckduckgo.com/?q=site%3Ahail2u.net" rel="search">

    <link href="/css/print.css?v=9.34.3" media="only print" rel="stylesheet">
    <link href="/css/index.css?v=9.34.3" media="only screen" rel="stylesheet">
  </head>

  <body>

      <nav id="top">
        <p class="logo"><a href="/"><span role="img" aria-label="ホームへ戻る">←</span></a></p>
      </nav>

      <header class="page-header">
          <p class="date"><time datetime="2025-02-21T12:14:55+09:00">2025年2月21日</time></p>

        <h1><em>text-spacing-trimプロパティーとpre要素</em></h1>
      </header>

    <main>
      <p>日本語などの約物に含まれる空白(例えば、開き鍵括弧の左にある空白)などを文脈に応じて詰める<a href="https://www.w3.org/TR/css-text-4/#propdef-text-spacing-trim"><code>text-spacing-trim</code>プロパティー</a>がChrome 123やEdge 123で<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/text-spacing-trim#browser_compatibility">一部実装</a>されている。特に指定せずにいたり、<code>:root</code>要素などで<code>trim-first</code>などを指定すると、初期値の関係や継承により<code>pre</code>要素でも詰められる。そうすると(対応するOpenType機能であるhaltを所持している)等幅フォント(例えばNoto Sans Mono CJK JP)で描画される場合に文字位置がずれてしまう。</p>

<p>仕様で初期値の<code>normal</code>はChrome 123やEdge 123の実装でも採用されている。この値では、日本語の約物が続く場合(例えば」「や。「など、<a href="https://www.w3.org/TR/css-text-4/#example-eec02af5">Text Module Level 4仕様のExample 41</a>を参照)にどちらかの約物の持つ空白を詰めるよう指示する。この値は継承されるため、<em>無指定でも<code>pre</code>要素で詰められる</em>ことから、文字が揃うかどうかは<em>ユーザーのフォント設定に依存する</em>可能性が高い。なぜならば制作者CSSにおいて<code>pre</code>要素のフォント指定で日本語の等幅フォントを指定することは少なく、この詰めが起こる日本語の約物はユーザーの設定したフォントやブラウザーの初期設定のフォントで描画されるからだ。</p>

<p>つまり<code>pre</code>要素では<code>text-spacing-trim: space-all</code>を必ず指定しておき、継承されないようにし、ずれないことを保証するべきではないかと考えられる。ルート要素などで<code>text-spacing-trim</code>プロパティーを使っていなくてもずれるかもしれないので、リセットやノーマライズの仕組みに組み込むのが妥当だと思う。副作用は無いと思われる。</p>

<p><code>pre</code>要素がこのプロパティーを継承してしまう仕様が悪いのか、等幅フォントなのに空白の詰めを司るOpenType機能を持っているフォントが悪いのか、微妙なところかもしれない。仕様側で要素によって既定値を変えて欲しいような気もするが、既に実装があるので面倒そうだ。制作者CSS側でほぼ確実に対処できるので、対処しておくに越したことはない。</p>
    </main>

    <footer class="page-footer">
      <hr>

        <p>このウェブサイトは<a href="mailto:hail2u@gmail.com">ながしまきょう</a>が<a title="Creative Commons (表示)" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>の下で作成、公開、そして更新しています。更新情報は<a href="/feed" type="application/rss+xml">RSS</a> (<a href="/blog/feed" type="application/rss+xml">記事だけのRSS</a>)または<a href="https://x.com/hail2u_">X</a>で購読できます。その他、わからないことは<a href="/#about">もう少し詳しい情報</a>を参照してください。</p>

      <p><a href="#top"><span aria-hidden="true">↑ </span>一番上</a></p>
    </footer>
  </body>
</html>
