<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>見出しの後ろにくる空白の調整</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2020-05-16</time></p>

    <h1>見出しの後ろにくる空白の調整</h1>

    <p>見出しの前には大きく空白があると読みやすいけど、見出しの直後に段落がくる場合は詰めたくなる。ウェブページでは、対応する<code>margin</code>プロパティーの値を<code>0</code>にするだけで終わりにしてしまいがち。この詰めをちゃんと計算するとしっくりくる、かもしれない。</p>

<p>ウェブページでは余白の取り方を統一することが多いので、<code>h2</code>要素を<code>margin-bottom: 0;</code>にしたり、<code>h2 + p</code>で<code>margin-top: 0;</code>にしたりする。しかし、見出しの大きさや行の高さによって、<em>見出しそのものの持つ空白</em>が<em>段落そのものが持つ空白</em>と違うので、ユーザーによっては、詰まりすぎに見えたり、詰まらなさすぎに見えたりする。</p>

<p>これはCSSの<code>line-height</code>プロパティーが文字の上下に空白を取る仕組みに由来する。問題とも言えるけど、これはこれで便利だったりすること(描画領域やフォント、文字サイズの違いに、公平にふるまう)もあるので、特性だろう。</p>

<p>例えば、見出しの文字サイズが<code>24px</code>で、行の高さが<code>30px</code>とする。また、段落の文字サイズが<code>16px</code>で、行の高さが<code>24px</code>とする。そうすると、見出しの下に<code>(30px - 24px) / 2 = 3px</code>、段落の上に<code>(24px - 16px) / 2 = 4px</code>の余白が常に存在するので、単に両者の間の余白を<code>0</code>にするだけでは、段落内の行間(leadingからcap heightを引いたもの)に比べて<code>1px</code>足らない。つまり、この場合はユーザーに詰まりすぎに見えたりする。</p>

<p>行間と同じになるように、ちゃんと計算すると、しっくりくると思う。上記例の設定では、以下のように計算する。</p>

<pre><code class="language-css">h2 + p {
  margin-top: calc(
    24px - 16px -
    (30px - 24px) / 2 -
    (24px - 16px) / 2
  );
}</code></pre>

<p>段落内での行間(<code>24px - 16px</code>)から、見出しの下の余白と、段落の上の余白を引く。見出しの文字サイズや行の高さに依存するので、結果は負の値になったりもするし、<code>0</code>になったりもするし、意外と大きな値になったりもする。これは一例に過ぎないけど、少なくとも<code>margin-top: 0</code>とするだけではダメだということは、なんとなく見えてくる。</p>

<p>実際にはもっと汎用化したい。対応するカスタム・プロパティーが定義済みとすると、以下のようにも書けるだろう。</p>

<pre><code class="language-css">h2 + p {
  margin-top: calc(
    (var(--line-height-p) - 1) * var(--font-size-p) -
    (var(--line-height-h2) - 1) * var(--font-size-h2) / 2 -
    (var(--line-height-p) - 1) * var(--font-size-p) / 2
  );
}</code></pre>

<p>基準の行間も、見出し(手前の要素)の下の空白も、段落(自分)の上の空白も、計算できる。<code>--line-height-*</code>は単位なしである必要があるけど、だいたいそうしていると思うので問題ないだろう。ただ、<code>--font-size-*</code>は<code>rem</code>単位か<code>px</code>単位などの、段落(自分)の文字サイズに影響を受けない単位である必要がある。もちろん、他の<code>margin</code>プロパティーで使っている単位と同じだとなおいい。</p>

<hr>

<p>将来的には、大文字の高さを参照する<code>cap</code>単位や、行の高さを参照する<code>lh</code>単位から、もっと汎用的なものも作れそうな気がしないでもない。それこそ、<code>p</code>要素で計算を設置しておけば、後は自動で調整してくれる仕組みとか、詰める専用のユーティリティー・クラスとかを作れる。ただ、他の要素の状態を参照しないといけないので、無理かもしれず、そうだとしたらちょっと残念。</p>

<p>このウェブサイトでは、雑記記事での見出しと投稿日時の間や、投稿一覧の日付とタイトルの間、ヘッダーやフッターが縦に重なる時の間などで使っている。おおまかに「セット」としてとらえてほしいもの同士の間で利用しているつもり。</p>

<p>まだ古い計算式で計算されてたり、間違った値を設定していたりする。この記事のタイトルは「見出しの～」だけど、小見出しと段落の間ではやめたりもした。文字サイズのバリエーションを減らしたので、ある程度の余白がないと、見出しが認識できないだろうと考え、やめてしまった。</p>

<p>また、似たような概念を、背景を塗りつぶした整形済みテキストや、図、表の上下の余白の調節にも使ってみている。こちらは標準の余白に、行間の半分を加えるというもので、「詰める」というより「空ける」。背景を塗りつぶしたり、表だったり、矩形をびっしりと埋めるものには、段落と違って、上下に行間の半分に相当する余白がない。それを加えることで、段落と表、表と段落などの間の余白と、段落と段落の間の余白を合わせてみようというわけ。</p>

<hr>

<p>バーティカル・リズムは、このあたりのことも含んだタイポグラフィー理論だけれど、俯瞰した時と周辺視での美しさに寄ったもので、やはり紙媒体で真価を発揮する理論だと思う。スクロールする限定的な領域で、コンテンツを読み進めていくウェブページでは、俯瞰することはあまりない。また、ウェブページでは描画領域に従って画像の大きさが変化することが多いので、そこでリズムを維持するのは難しい。そして一部でリズムが崩れたら、台無しになってしまう。</p>

<p>このように、バーティカル・リズムの威力は、ウェブページでは限定的にしか発揮されないんじゃないかとずっと考えている。この記事で扱ったような、比較対象(段落内での行間)が近いもの(見出しと段落の間を詰めた時の空白)では、正しく発揮される。そう割り切って、一部に導入するのも選択肢のひとつだと思い、ちょくちょく使ってみている。</p>
  </body>
</html>
