<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>記事フォーマットの変更</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2016-12-13</time></p>

    <h1>記事フォーマットの変更</h1>

    <p><a href="http://blosxom.sourceforge.net/">Blosxom</a>では記事ファイルの1行目がタイトル、それ以降が本文になる。他のプログラムから扱おうとすると、そこで分割しなくてはならないのでいろいろと面倒くさい。そこで<a href="https://github.com/hail2u/hail2u.net/blob/master/src/weblog/entries/changing-blosxom-entry-format.txt">それぞれの記事ファイル</a>の1行目を<code>h1</code>要素でマークアップしてしまうように変えた。</p>

<p>プレビューするツールを作るとかでも楽になることもそうだが、とりあえずほぼHTML文書らしき形になっていると、どうにでもできそうで良い。とくにそのまま<a href="https://github.com/tmpvar/jsdom">jsdom</a>などに何もせずに食わせることができるのも大きい。単純な置換では難しい細かい変更(マークアップの更新や文言のドラスティックな変更)をたまにやりたくなってしまうので、こうなっていると楽ができそうだ。</p>

<p>利用しているツールを変えるという場合でもHTMLならなんとかなるのではないか、という甘い見込みも少しある。単純にはうまくいかなかったとしても、jsdomで扱えればフォーマットを変換する何かも書きやすいのではないか、という更に甘い予測もしている。</p>

<p>このままだと本来のBlosxomによる出力側で変なになるので、テキトウに<code>h1</code>要素を削除してやるプラグインをでっち上げたりもした。プラグインのファイル名の先頭に<code>00</code>を付けて優先度を上げておけば、他のプラグインとの連携もうまくいく。</p>

<hr>

<p>記事ファイルそれぞれの更新はVimでやった。</p>

<pre><code class="language-vim">:vimgrep /\%^/ **/*.txt</code></pre>

<p>まずVimの正規表現が利用できる<code>:vimgrep</code>コマンドを使い、<code>\%^</code>でファイルの先頭をグレップしてやる。</p>

<pre><code class="language-vim">:cdo s/^\(.*\)$/&lt;h1&gt;$1&lt;\/h1&gt;/ | update</code></pre>

<p>そしてVim 8.0から入った<code>:cdo</code>コマンドを使い、置換して保存した。<code>:cdo</code>コマンドのヘルプを読むと、グレップ結果などのQuickFixに表示されている部分に限定して処理するわけではないようなので、注意が必要そうだ。</p>

<p>記事HTMLを再生成したところ変化はなかったので、うまく動いているのだろう。</p>

<hr>

<p>このまま勢いで似た何かをNode.jsで作ってしまいそうだ。</p>
  </body>
</html>
