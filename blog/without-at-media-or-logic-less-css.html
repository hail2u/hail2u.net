<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>@mediaなし、またはロジックレスCSS</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2019-06-06</time></p>

    <h1>@mediaなし、またはロジックレスCSS</h1>

    <p>このウェブサイトのCSSから<code>@media</code>ルールを極力なくした。今は亡き(殺した)CSS MQPackerへのモチベーションがゼロになったことをきっかけに、段階的に進めている。全廃はまだ難しいので、カスタム・プロパティーに代入していく<code>@media</code>ルールだけに絞り、それ以外でもなるべく使わない、という<a href="/main.20190418.css">方針</a>にした。</p>

<p>普通のCSSであるルールセット側はごくシンプルなコードになる。<code>var()</code>が多いけれども。よくあるプロパティーの上書きが起こらないので、メディア・クエリーがなかった時代のCSSっぽくなる。メディア・クエリーによるプロパティーの上書きを、カスタム・プロパティーによる値の動的変化に置き換えている、と説明できる。</p>

<p>あらかじめ設定したカスタム・プロパティー群をデータと捉え、そのデータを参照する側に<code>@media</code>ルールのようなロジックに相当するもの書かない、という見方もできる。これを踏まえてロジックレスCSSなどという説明をしている。</p>

<hr>

<p><code>@media</code>ルールの問題点は、書き方が難しいところだ。まとめて書いても、個々に書いても、問題が起こる。</p>

<p>モバイル・ファーストで、<code>@media</code>ルールをCSSの最後の方にまとめていくと、関連するスタイルが離れたところに書かれてしまう。その結果、最後に書かれた<code>@media</code>ルールで上書きされてしまい、直したつもりが直っていなかったりする。逆に、<code>@media</code>ルールで戻す必要があるパターンなどでは、上書きしてないおかげで、直したつもりが壊れてしまったりもする。</p>

<p>コンポーネントを意識して、個々に<code>@media</code>ルールを書いていくと、同じクエリーの<code>@media</code>ルールが分散してしまう。その結果、ウェブページにどのようなスタイルが当たるかの見通しが悪くなる。なんちゃってコンポーネントが相互に依存しあう現状では、不具合の原因究明に影を落とす。また、ファイルサイズもどんどん増えていく。</p>

<p>前者は<em>書く時</em>に問題が、後者は<em>確認する時</em>に問題が起こりやすい。それを解決するために、<code>@media</code>ルールをまとめるものを使ったり作ったりしたわけだが、これはこれでCSSの詳細度における問題が常に付きまとう。CSSは順序を変えるとよく壊れるからだ。</p>

<p>結局のところ、<code>@media</code>ルールはこういうものと捉えるしかない。でもその一部をうまく肩代わりさせることはできる。ひとつはGridやFlexboxのような標準レイアウト仕様による論理的なCSSコードへの昇華で、もうひとつがカスタム・プロパティーによる動的な値の変化を利用したCSSコードへの変更だ。と思う。一部と言ったが、多分7割くらいは置き換えた方が効率的なのではないか、と予想している。</p>

<hr>

<p>このウェブサイトのCSSの場合は、ファイル・サイズが1/6くらい減った(12KB→10KB)。強制的に<code>@media</code>ルールがまとめられる上、通常<em><code>@media</code>ルールに書かれるセレクターがなくなる</em>ので、変数が多ければ多いほど減りそうだ。反面、カスタム・プロパティー名が長くなりがちで、参照が多ければ増えるかもしれない。ただ、極端に悪化することはないだろう。</p>

<p>長くなりがちなカスタム・プロパティー名から想像できるように、ここでも名前付けの問題が起きる。そういう意味では革命的なアプローチではなさそうだ。</p>

<p>また、慣れないとコードを行ったり来たりしなければならないので読みづらい。開発者ツールやVisual Studio Codeには頑張ってもらいたい。他のファイルに書かれたカスタム・プロパティーを補完したい。</p>

<p>共同開発者にはカスタム・プロパティーのみを変更させるようにすれば、CSSコードそのものには手を入れさせないようにできる。雑な変更による影響を最小限に抑えられ、破綻する確率も下がるだろう。</p>

<hr>

<p>今のところは実証実験の初期段階だ。なんとかうまく動くし、ちょっとした変更では書き換えやすい。大きな変更でも、カスタム・プロパティーが多数存在するおかげで、部分的な再利用が可能になり、ちょっとした間違いが減る。デメリットは少ないようだ。</p>

<p>劇的な変更がコードに加わる割に、実際的なメリットは少ない。思想的な面での恩恵をメリットと捉えるかどうかで評価が大きく分かれそうだ。</p>
  </body>
</html>
