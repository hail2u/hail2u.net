<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>src属性のないimg要素と擬似要素</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2015-03-28</time></p>

    <h1>src属性のないimg要素と擬似要素</h1>

    <p><code>img</code>要素は置換要素なので、現在の安定仕様では明記されてはいないものの歴史的な事情により<code>::before</code>/<code>::after</code>擬似要素による挿入は行えない。しかしChrome 41で遊んだところ、<code>src</code>属性がない場合は挿入することができるようだ。Internet Explorer 11やFirefox 36、Mobile Safari 8では行えない。</p>

<p>Demo: <a href="/test/618.html">img element w/o src attribute and pseudo element</a></p>

<p>Chrome 41では<code>alt</code>属性の値である“img without src”という文字列の前に<code>::before</code>擬似要素で仕込んだ“pseudo element for img!”という文字列が挿入されていることがわかる。Chrome 43でも同様だった。</p>

<p><code>src</code>属性がないと<code>img</code>要素がパース・エラーで不明な要素にでもなるのかなと想像したが、<code>alt</code>属性がちゃんと展開されているのでそうではなさそうだ。<code>alt</code>属性が展開されるようなケースが特別扱いされているということなのだろうか。</p>

<hr>

<p>イシューを立てようかと思ったのだけど、仕様上は挿入してはならないことにはなっておらず、立てづらかったため保留した。CSS 2.1では「<a href="http://www.w3.org/TR/CSS2/generate.html#before-after-content">将来的には決めるつもりだけど、まだ決まってない</a>」となっている。それを決めるはずの<a href="http://www.w3.org/TR/2003/WD-css3-content-20030514/#replacedContent">CSS3 Generated and Replaced Content ModuleのReplaced contentの項</a>では<code>::outside::before</code>等を使えということになっているが2003年のWorking Draftで根拠にはしづらい。</p>

<p>意図的に行わないと再現しそうにないため、誤爆するということもなさそうなので、ここに記録するに留めておこう。</p>
  </body>
</html>
