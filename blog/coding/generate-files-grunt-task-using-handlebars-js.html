<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="light dark" name="color-scheme">
    <meta content="width=device-width" name="viewport">

    <title>Handlebars.jsを使ったファイル生成Gruntタスク</title>

    <link title="ウェブサイト全体のRSS" href="/feed" rel="alternate" type="application/rss+xml">
    <link title="記事だけのRSS" href="/blog/feed" rel="alternate" type="application/rss+xml">
    
    
    
    <link href="/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="mailto:hail2u@gmail.com" rel="author">
    <link href="https://hail2u.net/blog/coding/generate-files-grunt-task-using-handlebars-js.html" rel="canonical">
    <meta content="主にHTMLの生成を行うGruntタスクの話。色々なテンプレート・システムの利用を考えたんだけど、Handlebars.jsにした。よく使うからというのもあるし、いざとなったらデータの再構成を待たずにその場しのぎでテンプレートにロジックを混ぜてお茶を濁せるのが好き。その場しのぎ、お茶を濁す、良い言葉だ。" name="description">
    <link href="/favicon.svg" rel="icon" type="image/svg+xml">
    <link href="https://creativecommons.org/licenses/by/4.0/" rel="license">
    <link href="https://duckduckgo.com/?q=site%3Ahail2u.net" rel="search">

    <link href="/css/print.css?v=9.32.3" media="only print" rel="stylesheet">
    <link href="/css/index.css?v=9.32.3" media="only screen" rel="stylesheet">
  </head>

  <body>

      <nav id="top">
        <p class="logo"><a href="/"><svg viewBox="0 0 16 16" role="img" aria-labelledby="logo-title"><title id="logo-title">ホームへ戻る</title><path d="m 2,7 3,7 h 7 L 14,9 13,4 9,2 Z"/></svg></a></p>
      </nav>

      <header class="page-header">
          <p class="date"><time datetime="2013-08-24T12:10:30+09:00">2013年8月24日</time></p>

        <h1><em>Handlebars.jsを使ったファイル生成Gruntタスク</em></h1>
      </header>

    <main>

    <p><a href="https://gist.github.com/hail2u/6310613">主にHTMLの生成を行うGruntタスク</a>の話。色々なテンプレート・システムの利用を考えたんだけど、<a href="http://handlebarsjs.com/">Handlebars.js</a>にした。よく使うからというのもあるし、いざとなったらデータの再構成を待たずにその場しのぎでテンプレートにロジックを混ぜてお茶を濁せるのが好き。その場しのぎ、お茶を濁す、良い言葉だ。</p>

<p>このGruntタスクは指定されたHandlebars.jsテンプレート(例えば<code>foo.hbs</code>)をレンダリングするだけのもの。レンダリングに使うデータは、基本のメタデータ(<code>metadata.json</code>の内容)とテンプレート・ファイルごとに指定できるメタデータ(<code>foo.json</code>の内容)をGruntに含まれる<a href="http://lodash.com/">Lo-Dash</a>の<code>extend()</code>を使ってマージしたものを使う。Gistのサンプルにあるように基本のメタデータにないものを自由に追加できるし、基本のメタデータを上書きすることも出来る。</p>

<p>コアの<code>generate.js</code>では<code>include</code>というヘルパー関数を作って共通部分を別に切り出せるようにした。ほぼSSIのインクルードと同じようなもの。Handlebars.jsが優秀なので、取り込むテンプレートでも普通にデータの利用は可能。</p>

<p>テンプレートと出力が1対1なシステムなので、コンテンツ部分は直接テンプレートに混ぜている。僕の場合は大体HTMLで配信するものはHTMLで書くので、<a href="http://daringfireball.net/projects/markdown/">Markdown</a>で書いたコンテンツを外から取り込んで……とかそういうのを機能として作っちゃうまではやらなかった。これまたHandlebars.jsが優秀なので、別にMarkdownで書いたものをHTMLに変換してコンテンツとして取り込むなどもたぶんメタデータに関数書くだけでいける。コアでの変更はMarkdownをHTMLに変換するための<a href="https://github.com/chjj/marked">Marked</a>等を<code>require()</code>しておくくらい。</p>

<p>あとは<a href="http://gruntjs.com/">Grunt</a>の動的マッピングや柔軟なタスク構成にお任せ。サンプルの<code>Gruntfils.js</code>のように動的マッピングで指定ディレクトリ以下の<code>*.hbs</code>を一気に処理するのが基本で、指定したファイルのリビルドだけを行うのを作っておいたりとか、ウェブログの更新に伴いいくつかのファイルの更新だけを行うのを作っておいたりとか環境に合わせて色々タスク設定を作る。例えば指定したファイルのリビルドなら以下の様な設定を作ってやると良い。</p>

<pre><code class="language-javascript">generate: {
  file: {
    expand: true,
    cwd: &apos;.grunt/html/&apos;,
    src: grunt.option(&apos;file&apos;),
    filter: &apos;isFile&apos;,
    dest: &apos;./&apos;,
    ext: &apos;.html&apos;
  }
}</code></pre>

<p>これで<code>--file</code>オプションを見て生成できる。</p>

<pre><samp>$ <kbd>grunt generate:file --file=index.hbs</kbd></samp></pre>

<p>面倒くさいテンプレートと出力のマッピングや、コマンド(やボタン)一発で作業を一気にこなすというようなCMSの基本的な部分をGruntによっかかっている。するとこのような数十行のJavaScriptでウェブサイトの管理……とまではいかないけど、効率的な運営くらいは可能になる。</p>

    </main>

    <footer class="page-footer">
      <p>このウェブサイトは<a href="mailto:hail2u@gmail.com">ながしまきょう</a>が<a title="Creative Commons (表示)" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>の下で作成、公開、そして更新しています。更新情報は<a href="/feed" type="application/rss+xml">RSS</a> (<a href="/blog/feed" type="application/rss+xml">記事だけのRSS</a>)または<a href="https://x.com/hail2u_">X</a>で購読できます。その他、わからないことは<a href="https://hail2u.net/about/">もう少し詳しい情報</a>を参照してください。</p>

      <p><a href="#top"><span aria-hidden="true">↑ </span>一番上</a></p>

      <p><a href="/"><span aria-hidden="true">≡ </span>サイト・メニュー</a></p>
    </footer>
  </body>
</html>
