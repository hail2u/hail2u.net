<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>PostCSS v4と空白</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2015-01-11</time></p>

    <h1>PostCSS v4と空白</h1>

    <p><a href="https://github.com/postcss/postcss/releases/tag/4.0.0">PostCSSのv4.0.0</a>が年明け早々に出た。互換性のない変更の中では、v3.0.0で<code>childs</code>と妙なスペルで名付けられたものが<code>nodes</code>に修正されたことが一番大きそうだ。他、便利メソッドの追加に加え、空白の最適化機能が大幅に変更になった。</p>

<p>ソースを読んでもよくわからなかったので<a href="https://github.com/postcss/postcss/issues/165">イシューを立てて聞いたところ</a>、思ったよりもかなり複雑そうだった。しかしよく練られてはいる印象は持ったので、これに任せてしまうのが賢そうだ。つまりノードを動かす時には<code>clone()</code>を通すか、新メソッドの<code>moveTo()</code>などを使ってやることで、まずノードの空白関連のプロパティーをリセットする。後はPostCSSに前後のノードを参照するかデフォルトのフォーマットを採用するかを選択させるという形だ。</p>

<p>PostCSS側の変更でテストの期待される結果は書き直さなければならなそうだが、ライブラリー側で余計なことをするよりかはコストが低いと思われる。</p>
  </body>
</html>
