<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>このエントリを含むエントリ</title>

    <style>
      body {
        font-family: sans-serif;
        font-size: 112.5%;
        margin-block-end: 25svh;
      }

      pre {
        white-space: pre-wrap;
      }

      figure {
        margin-inline: 0;
      }

      img,
      svg {
        block-size: auto;
        max-inline-size: 100%;
      }
    </style>
  </head>

  <body>
    <p><time>2009-06-07</time></p>

    <h1>このエントリを含むエントリ</h1>

    <p><a href="http://b.hatena.ne.jp/">はてなブックマーク</a>にある「このエントリを含むエントリ」機能のようなものを<a href="/test/112.html">JavaScript+jQueryで書いてみた</a>。ソースは<a href="http://blogsearch.google.co.jp/">Googleブログ検索</a>で<code>link:</code>プリフィックスを使用した検索。この検索結果はAtom (やRSS 2.0)で拾えるので、それを<a href="http://developer.yahoo.com/yql/">YQL</a>に投げてJavaScriptだけで書いた。最初ははてブのエントリ情報のページをスクレイピングして作ってたんだけど、こっちを思いついたのでこっちで。</p>

<p>YQLへのクエリは、</p>

<pre>select * from atom where url=&apos;http://blogsearch.google.co.jp/blogsearch_feeds?scoring=d&amp;output=atom&amp;q=link:http://example.com/foo/bar.html&apos;</pre>

<p>という感じで、エントリのフルパスを指定してやれば良い(http://は削らなくてもOK)。<code>scoring</code>パラメータで日付順にするかどうかは好みで。日本語のブログに限定にするなら<code>lr=lang_ja</code>とかを追加すれば良い。</p>

<p>はてブの実装がどうなっているかは知らないんだけど、きっとブックマークされた時にリンクをリストアップしてると思うので、ブックマークされてないページからのリンクは拾えないんじゃないかと思う。Googleブログ検索の方はフィードを配信しているサイトのからのリンクならほぼ全て拾えると思うので、より多くのリンクを拾えるのではないかと思う。逆にスパム・ブログみたいなものも含まれてしまうとも言える。そういう意味でははてブのリストの方が洗練されたものであるかもしれない。どっちもどっち。</p>
  </body>
</html>
