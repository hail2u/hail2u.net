<!DOCTYPE html>
<html lang="ja" itemscope itemtype="http://schema.org/BlogPosting">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width" name="viewport">
    
      
      <meta content="なんとなくGoogleを利用したサイト内検索を変更したくなったので、MSN Searchを利用して作ってみました(タイトルと違う)。結局はタイトルの通り、Yahoo! Search Web Servicesを利用したもので作り上げたわけですが。" name="description">
      <meta content="blosxom v2.1.2+dev" name="generator">
    
    

    <title>Yahoo! Search Web Servicesでサイト内検索機能 - Weblog - Hail2u.net</title>

    <link href="/apple-touch-icon.png" rel="apple-touch-icon" type="image/png">
    <link href="/blog/coding/site_search_powered_by_y.html" rel="canonical">
    <link href="/feed" rel="alternate" type="application/rss+xml">

    <link rel="prev" href="/blog/sports/ball_dog.html">

    

    
      <meta content="Yahoo! Search Web Servicesでサイト内検索機能" property="og:title">
      <meta content="http://hail2u.net/apple-touch-icon.png" property="og:image">
      <meta content="なんとなくGoogleを利用したサイト内検索を変更したくなったので、MSN Searchを利用して作ってみました(タイトルと違う)。結局はタイトルの通り、Yahoo! Search Web Servicesを利用したもので作り上げたわけですが。" property="og:description">
    

    <meta content="article" property="og:type">
    <meta content="http://hail2u.net/blog/coding/site_search_powered_by_y.html" property="og:url">
    <meta content="ja_JP" property="og:locale">
    <meta content="Hail2u.net" property="og:site_name">
    <meta content="https://www.facebook.com/hail2u" prefix="article: http://ogp.me/ns/article#" property="article:author">
    <meta content="100000022521341" prefix="fb: http://ogp.me/ns/fb#" property="fb:admins">

    <meta content="summary" name="twitter:card">
    <meta content="@hail2unet" name="twitter:site">
    <meta content="@hail2u_" name="twitter:creator">

    <link href="/styles/style.min.css" rel="stylesheet">

    <script async src="/scripts/main.min.js"></script>
    
    <!-- Google AdSense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-42525667-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
      
      <div class="global-header" role="banner">
    
      
    
      <nav>
        <a class="logo" href="/"><img alt="Hail2u.net" src="/images/logo.min.svg"></a>
    
        <ul class="site-navigation">
            <li><a href="/blog/"><mark>Weblog</mark></a></li>
            
    
          
          
          <li><a href="/documents/">Documents</a></li>
          
          <li><a href="/about/">About</a></li>
        </ul>
      </nav>
    
      
      
      </div>
    

    <div class="content">
    
      


      <div role="main">
      
        <meta content="http://hail2u.net/apple-touch-icon.png" itemprop="image">
        <link href="/blog/coding/site_search_powered_by_y.html" itemprop="url">

        <h1 class="first-heading" itemprop="name">Yahoo! Search Web Servicesでサイト内検索機能</h1>

        <footer class="section-footer">
          <p><time class="date" datetime="2005-03-09T16:57:00+09:00" itemprop="datePublished">Mar 9, 2005</time>
            · <span class="tag" itemprop="keywords"><a href="/blog/coding/">Coding</a></span></p>
        </footer>

        <div itemprop="articleBody"><p itemprop="description">なんとなく<a href="http://www.google.com/" title="Google">Google</a>を利用したサイト内検索を変更したくなったので、<a href="http://search.msn.com/" title="MSN Search">MSN Search</a>を利用して作ってみました(タイトルと違う)。結局はタイトルの通り、<a href="http://developer.yahoo.net/" title="Yahoo! Search Web Services">Yahoo! Search Web Services</a>を利用したもので作り上げたわけですが。</p>
<p>MSN SearchはWeb Serviceとして開発者向けに何かを公開しているわけではないのですが、検索結果のRSSフィード(RSS 2.0)を提供をしています。そのRSSフィードへのアクセスは至極単純で、<code>format=rss</code>を通常の検索結果のページのURLに追加するだけです(<a href="http://search.msn.com/results.aspx?q=rss+site%3ahail2u.net&format=rss" title="MSN Search Feed: rss site:hail2u.net">例: rss site:hail2u.net</a>)。なので、RSSをHTMLに変換するようなCGIで比較的簡単にサイト内検索を構築できたりします。実際に<a href="http://search.cpan.org/search?module=LWP%3A%3ASimple" title="search.cpan.org: LWP::Simple - simple procedural interface to LWP">LWP::Simple</a>と<a href="http://search.cpan.org/search?module=XML%3A%3ARSS" title="search.cpan.org: XML::RSS - creates and updates RSS files">XML::RSS</a>を利用したものはものの数分で作れました。</p>
<p>ただ、検索結果のRSSフィードには、</p>
<blockquote>
<p>Copyright &#169; 2005 Microsoft. All rights reserved. These XML results may not be used, reproduced or transmitted in any manner or for any purpose other than rendering MSN Search results within an RSS aggregator for your personal, non-commercial use. Any other use of these results requires express written permission from Microsoft Corporation. By accessing this web page or using these results in any manner whatsoever, you agree to be bound by the foregoing restrictions.</p>
</blockquote>
<p>と記述されているので、いわゆるフィード・リーダー以外で利用するには、Microsoftからきちんとした許可証を頂かなくてはならないっぽい。</p>
<p>てなわけでYahoo! Search Web Servicesでやってみたわけですよ。</p>
<p>Yahoo! Search Web Servicesは、</p>
<pre>http://api.search.yahoo.com/{ServiceName}/{ServiceVersion}}/{ServiceMethod}
</pre>
<p>というURLにパラメータで細かい指定をし、そのURLをGETするとXMLで検索結果が返ってくるというWeb Serviceなので、作業の推移は、</p>
<ol>
<li>URLを作成</li>
<li>URLにGETをかける</li>
<li>返ってきたXMLをパース</li>
<li>出力</li>
</ol>
<p>と言う感じになります。つまり<a href="http://search.cpan.org/search?module=URI" title="search.cpan.org: URI - Uniform Resource Identifiers (absolute and relative)">URI</a>+LWP::Simple+<a href="http://search.cpan.org/search?module=XML%3A%3ASimple" title="search.cpan.org: XML::Simple - Easy API to maintain XML (esp config files)">XML::Simple</a>という組み合わせで扱えるもの。<a href="http://www.amazon.co.jp/exec/obidos/subst/associates/join/webservices.html" title="Amazon Webサービス">Amazon Web Services</a>のXML over HTTPとほとんど同じ感覚で扱えるってわけですね。</p>
<p>実際にはYahoo! Search Web ServicesのSDKに<a href="http://search.cpan.org/search?module=Yahoo%3A%3ASearch" title="search.cpan.org: Yahoo::Search - Perl interface to Yahoo! Search's public API.">Yahoo::Search</a>という、上記推移だと1～3をやってくれるモジュールが含まれており、単純に作れる・・・のですが、サイト内検索などの限定した利用の場合はURI+LWP::Simple+XML::Simpleを使った方が把握しやすい気がする。リクエストが不正な場合などはステータス・コードで拾えるので、エラー時に返されるXMLは意識しなくて良いっぽい感じですし(気を付けるのは検索結果が0件の場合くらい)。</p>
<p>完成はしたもののあまり使い勝手の良いものにはならなかったので、まだ採用はしていません。流行りのLiveSearch系(xmlHttpRequestによるページ遷移の無い検索)で実装しようかなとかくだらないことばかり考えてたりとか。</p></div>

        <aside class="share-buttons">
          <ul>
            <li class="twitter-tweet"><a href="https://twitter.com/intent/tweet?text=Yahoo%21%20Search%20Web%20Services%E3%81%A7%E3%82%B5%E3%82%A4%E3%83%88%E5%86%85%E6%A4%9C%E7%B4%A2%E6%A9%9F%E8%83%BD%20-%20Weblog%20-%20Hail2u.net&amp;url=http%3A%2F%2Fhail2u.net%2Fblog%2Fcoding%2Fsite_search_powered_by_y.html&amp;via=hail2unet&amp;related=hail2u_">Tweet</a></li>
            <li class="facebook-share"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fhail2u.net%2Fblog%2Fcoding%2Fsite_search_powered_by_y.html">Share</a></li>
            <li class="googleplus-share"><a href="https://plus.google.com/share?url=http%3A%2F%2Fhail2u.net%2Fblog%2Fcoding%2Fsite_search_powered_by_y.html">Share</a></li>
            <li class="hatena-bookmark"><a href="http://b.hatena.ne.jp/my/add.confirm?title=Yahoo%21%20Search%20Web%20Services%E3%81%A7%E3%82%B5%E3%82%A4%E3%83%88%E5%86%85%E6%A4%9C%E7%B4%A2%E6%A9%9F%E8%83%BD%20-%20Weblog%20-%20Hail2u.net&amp;url=http%3A%2F%2Fhail2u.net%2Fblog%2Fcoding%2Fsite_search_powered_by_y.html">Bookmark</a></li>
          </ul>
        </aside>
      </div>
      

      
        <aside class="ads">
          <!-- Hail2u.net (Main) -->
          <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-8712792805045949"
            data-ad-format="rectangle, horizontal"
            data-ad-slot="1723739447"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </aside>
      

      
        <nav class="read-older">
          <a href="/blog/sports/ball_dog.html" rel="prev">
  <p>ボールドッグ</p>
</a>


        </nav>
      

      
    
    </div>

    <aside class="subcontent">
      <!-- Google Custom Search Engine -->
      <form class="site-search" action="https://www.google.com/cse" role="search">
        <input name="cx" type="hidden" value="partner-pub-8712792805045949:3747342316">
        <input name="ie" type="hidden" value="UTF-8">
        <input class="query" name="q" size="32" type="search">
        <input class="button" name="sa" type="submit" value="Search">
      </form>
    </aside>

    <footer class="global-footer" role="contentinfo">
      <section class="footlinks">
        <ul>
          <li><a href="http://creativecommons.org/licenses/by-nc/4.0/" rel="license">CC BY-NC</a></li>
            <li><a href="https://twitter.com/hail2unet">Twitter</a></li>
            <li><a href="https://www.facebook.com/hail2u.net">Facebook</a></li>
            <li><a href="http://u2liah.tumblr.com/">Tumblr</a></li>
            <li><a href="/feed" rel="alternate" type="application/rss+xml">RSS</a></li>
        </ul>
      </section>
    
      <p id="author" class="byline" itemprop="author" itemscope itemtype="http://schema.org/Person">Made by <span itemprop="name"><a href="https://kyonagashima.com/" rel="author" itemprop="url">Kyo Nagashima</a></span>.</p>
    </footer>
  </body>
</html>
<!-- DEBUG: Hello from Blosxom 2.1.2+dev. -->
