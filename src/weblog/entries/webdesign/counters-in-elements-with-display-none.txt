display: none;した要素でのCSSカウンター

<p>あまり<a href="http://www.w3.org/TR/CSS2/generate.html#counters">CSSカウンター</a>を使ったことがなかったので知らなかったんですが、<a href="http://www.w3.org/TR/CSS2/generate.html#undisplayed-counters"><code>display: none;</code>した要素ではインクリメントやリセットされない</a>という仕様があったんですね。いっぱいあるセクションにCSSカウンターで番号を振って、特定のものだけ表示しようとして引っかかりました。</p>

<p class="seealso">View Demo: <a href="/pub/test/302.html">display: none; and counter-increment</a></p>

<p>デモではそれぞれのセクションに<code>p</code>要素が8つあり、それに</p>

<pre><code class="language-css">section {
  counter-reset: test;
}

p::before {
  counter-increment: test;
  content: "Count " counter(test) ": ";
}
</code></pre>

<p>として頭に数字を追加するようにCSSを書きました。2つ目のセクションでは更に2番目から7番目の<code>p</code>要素を<code>display: none;</code>で非表示にしています。どのブラウザでも仕様通り2つ目のセクションでは8番目の<code>p</code>要素の数字が<code>2</code>になっていますね。CSS3でもこの仕様に<a href="http://www.w3.org/TR/css3-content/#counters0">変更は無い</a>ようです。</p>

<p>やろうとしていたことではとりあえず見えなければ良いというだけだったので、</p>

<pre><code class="language-css">.foo {
  position: absolute;
  bottom: 1000%;
}
</code></pre>

<p>という形で隠すことでごまかしました。</p>

<p>前に全部ちゃんと読んだのはもう5年以上前だと思うので、そろそろ仕様書を再び読み直す必要がありますね。CSS 2.1仕様書読書会とかあったら参加したいような気がします。気がするだけですけどね。</p>
