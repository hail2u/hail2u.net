<h1>検索フォームとそれへのページ内リンクによるフォーカス</h1>

<p>検索フォームへは移動と同時にフォーカスもさせたい。そうしておかないと、入力可能にするにはもう一度クリックしなくてはならず、フラストレーションがたまるからだ。このウェブサイトでは<code>input[type=&quot;search&quot;]</code>にIDを振ることで実現しておいた。HTMLコードだけで実装できる。しかし、Firefox 54やMobile Safari 10.2ではうまくフォーカスが当たってくれない。</p>

<p>See also: <a href="/pub/test/670.html">Fragment ID and Focus Management</a></p>

<p>Firefox 54ではフォーカス順の位置は入力ボックスの位置に移るが、入力可能な状態にはならない。Mobile Safari 10.2では入力ボックスがズームされ、キーボードが出てくるが、実際には入力することはできない。</p>

<p><a href="https://html.spec.whatwg.org/multipage/browsers.html#scroll-to-fragid">フラグメントをたどる仕様</a>によると<q>Run the focusing steps for target</q>というステップが存在する。それならばフォーカスが当たるのが正しいはずだ。Firefox 54やMobile Safari 10.2のバグと言えるだろう。とはいうものの、仕様の後出しのようなので、まだ反映されていないだけとも言える。</p>

<p>バグだ！と言っててもしょうがないので、JavaScriptでフォローした方が良いかもしれない。JavaScriptで制御する場合は、リンクをジャックするのではなく、<code>hashchange</code>イベントを利用すると良さそうだ。DOM構築を待つ必要がないため、低コストで初期化できるはずだ。</p>

<hr>

<p>今のところブラウザーのせいにして何もしていない。Firefoxはともかくとして、Mobile Safari 10.3で治っていなかったら直すつもりだ。</p>

<p>Firefoxには12年前からバグが立っていた。仕様の更新を受け、実装作業が進んでいるようだ。Safariにも同じようなバグがあり、パッチも登録されている。挙動が統一される可能性は高い。</p>
